<h1>Realistic AutoAnnotation Tool (Updated: 2022/05/3)</h1>
This is an experimental project to implement <b>A Realistic AutoAnnotation Tool(ARAAT)</b> for Object Detection.<br>

It generates a realistic dataset for training and validation, which is an artifically made from a lot of 
base images, and annotate those images automatically for object detection.

<h2>1 Realistic AutoAnnotation Tool </h2>
Please clone this repository to your local machine.<br>
git clone https://github.com/sarah-antillia/Realistic-AutoAnnotation-Tool.git<br>
You can see the following tree structure by tree command, and the projects folder contains a sample project 
<b>Japanese-RoadSigns-90classes</b>.<br> 
<h3>1.1 Folder tree structure</h3>
<pre>
└─projects
    └─Japanese-RoadSigns-90classes
        ├─background_test
        ├─background_train
        ├─background_valid
        ├─Enhanced_images_test
        ├─Enhanced_images_train
        ├─Enhanced_images_valid
        ├─PNG_RoadSigns_Japan_90classes_small
        ├─PNG_RoadSigns_Japan_90classes_tiny
        ├─realistic_test_dataset
        ├─TFRecord_Japanese_RoadSigns_90classes
        │  ├─train
        │  └─valid
        └─YOLO_Japanese_RoadSigns_90classes
            ├─train
            └─valid
</pre>
 
<b>PNG_RoadSigns_Japan_90classes_small</b> and <b>PNG_RoadSigns_Japan_90classes_tiny</b> folders contain a set of 
90 classes Japanese RoadSigns PNG file.<br>

<b>TFRecord_Japanese_RoadSigns_90classes</b> and <b>YOLO_Japanese_RoadSigns_90classes</b> are annotated tfrecord YOLO dataset for 
train and valid for object detection, which have been generated by this tool.<br>  

<h3>1.2 Create your own project </h3>

1. Create your own project under the <b>projects</b> folder.<br>
2. Prepare a set of object images of some classes.<br>
3. Prepare a set of background images for train, valid and test.<br>


<h2>2 Generate enhanced images </h2>
For our sample project <b>Japanese-RoadSigns-90classes</b>, we have created the following bat(sh) file 
<b>jp_roadsigns_image_enhancer.bat</b>, which will create enhanced images from base object images.<br>
<pre>
python ImageEnhancer.py ./projects/Japanese-RoadSigns-90classes/image_enhancer.conf train
python ImageEnhancer.py ./projects/Japanese-RoadSigns-90classes/image_enhancer.conf valid
python ImageEnhancer.py ./projects/Japanese-RoadSigns-90classes/image_enhancer.conf test
</pre>

For example, the first line of this bat will generate Enhancesd_train images dataset
from base images dataset, based on <b>image_enhancer.conf</b>.
<pre>
;image_enhander.conf
[configs]
warp_rotator_config_small     = "./projects/Japanese-RoadSigns-90classes/warp_rotator_small.conf"
warp_rotator_config_tiny      = "./projects/Japanese-RoadSigns-90classes/warp_rotator_tiny.conf"
warp_trapezoider_config_small = "./projects/Japanese-RoadSigns-90classes/warp_trapezoider_small.conf"
warp_trapezoider_config_tiny  = "./projects/Japanese-RoadSigns-90classes/warp_trapezoider_tiny.conf"
enhanced_images_dir           = "./projects/Japanese-RoadSigns-90classes/Enhanced_images"
</pre>

For example, warp_rotator_small.conf is the following, which can be used in ImageWarpRotator.py<br>
<pre>
; warp_rotator_small.conf
[train]
input_dir   = "./projects/Japanese-RoadSigns-90classes/PNG_RoadSigns_Japan_90classes_small"
;output_dir = "./projects/Japanese-RoadSigns-90classes/train_rotated"
angles      = [ -4, -2, 3, 4,] 

[valid]
input_dir   = "./projects/Japanese-RoadSigns-90classes/PNG_RoadSigns_Japan_90classes_small"
;output_dir = "./projects/Japanese-RoadSigns-90classes/train_valid"
angles      = [-3, 1, 2,] 

[test]
input_dir   = "./projects/Japanese-RoadSigns-90classes/PNG_RoadSigns_Japan_90classes_small"
;output_dir = "./projects/Japanese-RoadSigns-90classes/test_valid"
angles      = [ -1, 1,] 
</pre>

Similarly, warp_trapezoider_small.conf is the following, which can be used in ImageWarpTrapezoider.py<br>
<pre>

[train]
input_dir   = "./projects/Japanese-RoadSigns-90classes/PNG_RoadSigns_Japan_90classes_small"
;output_dir = "./projects/Japanese-RoadSigns-90classes/train_trapezoided"
policy      = 2
ws_list     = [0.01, 0.02, 0.04]
hs_list     = [0.01, 0.02, 0.04]

[valid]
input_dir   = "./projects/Japanese-RoadSigns-90classes/PNG_RoadSigns_Japan_90classes_small"
;output_dir = "./projects/Japanese-RoadSigns-90classes/valid_trapezoided"
policy      = 2
ws_list     = [0.02, 0.03]
hs_list     = [0.02, 0.03]

[test]
input_dir   = "./projects/Japanese-RoadSigns-90classes/PNG_RoadSigns_Japan_90classes_small"
;output_dir = "./projects/Japanese-RoadSigns-90classes/test_trapezoided"
policy      = 2
ws_list     = [0.01]
hs_list     = [0.02]
</pre>

<h2>3 Create YOLO dataset</h2>
For our sample project <b>Japanese-RoadSigns-90classes</b>, we have created the following bat(sh) file.<br>
jp_roadsigns_yolo_train_dataset_creator.bat<br>, which will create train and valid dataset with YOLO annotation format.
<pre>
python YOLOTrainDatasetCreator.py ./projects/Japanese-RoadSigns-90classes/train_dataset_creator.conf train
python YOLOTrainDatasetCreator.py ./projects/Japanese-RoadSigns-90classes/train_dataset_creator.conf valid
</pre>
train_dataset_creator.conf<br>
<pre>
; train_dataset_creator.conf
[dataset]
name            = "jp_roadsigns_90"
copyright       = "antillia.com"
version         = "1.0"
background_size = [512,512]
max_image_size  = [240,240]
classes         = "./projects/Japanese-RoadSigns-90classes/classes.txt"

[train]
backgrounds_dir = "./projects/Japanese-RoadSigns-90classes/background_train"
images_dir      = "./projects/Japanese-RoadSigns-90classes/Enhanced_images_train"
output_dir      = "./projects/Japanese-RoadSigns-90classes/YOLO_Japanese_RoadSigns_90classes/train"

[valid]
backgrounds_dir = "./projects/Japanese-RoadSigns-90classes/background_valid"
images_dir      = "./projects/Japanese-RoadSigns-90classes/Enhanced_images_valid"
output_dir      = "./projects/Japanese-RoadSigns-90classes/YOLO_Japanese_RoadSigns_90classes/valid"
</pre>

Sample images of train dataset<br>
<table>
<tr><td>
<img src="./projects/Japanese-RoadSigns-90classes/YOLO_Japanese_RoadSigns_90classes/train/jp_roadsigns_90_1000.jpg" width="400" height="auto">
</td></tr>
<tr><td>
<img src="./projects/Japanese-RoadSigns-90classes/YOLO_Japanese_RoadSigns_90classes/train/jp_roadsigns_90_1101.jpg" width="400" height="auto">
</td></tr>
<tr><td>
<img src="./projects/Japanese-RoadSigns-90classes/YOLO_Japanese_RoadSigns_90classes/train/jp_roadsigns_90_1202.jpg" width="400" height="auto">
</td></tr>
<tr><td>
<img src="./projects/Japanese-RoadSigns-90classes/YOLO_Japanese_RoadSigns_90classes/train/jp_roadsigns_90_1303.jpg" width="400" height="auto">
</td></tr>
<tr><td>
<img src="./projects/Japanese-RoadSigns-90classes/YOLO_Japanese_RoadSigns_90classes/train/jp_roadsigns_90_1404.jpg" width="400" height="auto">
</td></tr>
<tr><td>
<img src="./projects/Japanese-RoadSigns-90classes/YOLO_Japanese_RoadSigns_90classes/train/jp_roadsigns_90_1505.jpg" width="400" height="auto">
</td></tr>
<tr><td>
<img src="./projects/Japanese-RoadSigns-90classes/YOLO_Japanese_RoadSigns_90classes/train/jp_roadsigns_90_1606.jpg" width="400" height="auto">
</td></tr>

</table>
<br>
YOLO annotation inspection(Labelme)<br>
<img src="./assets/YOLOAnnotationInspection.png" width="640" height="auto"><br>

<br>
<h2>4 Create TFRecord dataset </h2>
For our sample project <b>Japanese-RoadSigns-90classes</b>, we have created the following bat(sh) file <b>
jp_roadsigns_tfrecord_creator.bat</b>, which will create train and valid TFRecord from YOLO annotated dataset.
<pre>
python YOLO2TFRecordCreator.py ./projects/Japanese-RoadSigns-90classes/yolo2tfrecord_creator.conf
</pre>

yolo2tfrecord_creator.conf<br>
<pre>
; yolo2tfrecord_creator.conf

[dataset]
name         = "jp_roadsigns"
copyright    = "antillia.com"
version      = "1.0"
classes      = "./projects/Japanese-RoadSigns-90classes/classes.txt"
tfrecord_dir = "./projects/Japanese-RoadSigns-90classes/TFRecord_Japanese_RoadSigns_90classes"
label_map_pbtxt  = "./projects/Japanese-RoadSigns-90classes/TFRecord_Japanese_RoadSigns_90classes/label_map.pbtxt"
label_map_yaml   = "./projects/Japanese-RoadSigns-90classes/TFRecord_Japanese_RoadSigns_90classes/label_map.yaml"

[train]
images_dir  = "./projects/Japanese-RoadSigns-90classes/YOLO_Japanese_RoadSigns_90classes/train"
anno_dir    = "./projects/Japanese-RoadSigns-90classes/YOLO_Japanese_RoadSigns_90classes/train"

[valid]
images_dir  = "./projects/Japanese-RoadSigns-90classes/YOLO_Japanese_RoadSigns_90classes/valid"
anno_dir    = "./projects/Japanese-RoadSigns-90classes/YOLO_Japanese_RoadSigns_90classes/valid"

</pre>

<br>
Please run the following bat file to inspect the generated tfrecord.<br>
tfrecord_inspect.bat<br>
<pre>
python TFRecordInspector.py  ^
  ./projects/Japanese-RoadSigns-90classes/TFRecord_Japanese_RoadSigns_90classes/train/train.tfrecord ^
  ./projects/Japanese-RoadSigns-90classes/TFRecord_Japanese_RoadSigns_90classes/label_map.pbtxt ^
  ./Inspector/train
</pre>
<br>
Objects count in tfrecord:<br>
<img src="./assets/TFRecordInspector_objects_count.png" width="640" height="auto"><br>
<br>
Sample images in tfrecord:<br>
<img src="./assets/TFRecordInspector_train.png"  width="640" height="auto"><br>

<h2>5 Create realistic test dataset </h2>
For our sample project <b>Japanese-RoadSigns-90classes</b>, we have created the following bat(sh) file
<b>jp_roadsigns_yolo_test_dataset_creator.bat</b>, which will create realistic test dataset with YOLO annotation.
<pre>
python YOLOTestDatasetCreator.py ./projects/Japanese-RoadSigns-90classes/test_dataset_creator.conf
</pre>

<pre>
; test_dataset_creator.conf
[dataset]
name            = "jp_test_roadsigns_90"
copyright       = "antillia.com"
version         = "1.0"
background_size = [1280,720]
max_image_size  = [240, 240]
classes         = "./projects/Japanese-RoadSigns-90classes/classes.txt"

[test]
backgrounds_dir = "./projects/Japanese-RoadSigns-90classes/background_test/"
images_dir      = "./projects/Japanese-RoadSigns-90classes/Enhanced_images_test"
output_dir      = "./projects/Japanese-RoadSigns-90classes/realistic_test_dataset"
num_test_dataset= 100

</pre>


Sample images of realist_test_dataset<br>
<table>
<tr><td>
<img src="./projects/Japanese-RoadSigns-90classes/realistic_test_dataset/jp_test_roadsigns_90_1000.jpg" width="640" height="auto">
</td></tr>
<tr><td>
<img src="./projects/Japanese-RoadSigns-90classes/realistic_test_dataset/jp_test_roadsigns_90_1001.jpg" width="640" height="auto">
</td></tr>
<tr><td>
<img src="./projects/Japanese-RoadSigns-90classes/realistic_test_dataset/jp_test_roadsigns_90_1002.jpg" width="640" height="auto">
</td></tr>
<tr><td>
<img src="./projects/Japanese-RoadSigns-90classes/realistic_test_dataset/jp_test_roadsigns_90_1003.jpg" width="640" height="auto">
</td></tr>
<tr><td>
<img src="./projects/Japanese-RoadSigns-90classes/realistic_test_dataset/jp_test_roadsigns_90_1004.jpg" width="640" height="auto">
</td></tr>
<tr><td>
<img src="./projects/Japanese-RoadSigns-90classes/realistic_test_dataset/jp_test_roadsigns_90_1005.jpg" width="640" height="auto">
</td></tr>
<tr><td>
<img src="./projects/Japanese-RoadSigns-90classes/realistic_test_dataset/jp_test_roadsigns_90_1006.jpg" width="640" height="auto">
</td></tr>

</table>


